
@{
    ViewData["Title"] = "企业污染物排放";
}

<style>
    .layui-select-title input {
        width: 194px;
    }

    .layui-form-pane .layui-form-select {
        width: 194px;
    }

    .v-modal {
        display: none;
    }

    #app {
        margin-top: 15px;
        padding: 15px;
        background-color: #fff;
    }
</style>
<div id="app">
    <el-form :inline="true" class="demo-form-inline">
        <div class="layui-row">
            <el-form-item label="企业名称">
                <el-input placeholder="请输入企业名称" v-model="orgname"></el-input>
            </el-form-item>
            <el-form-item label="企业信用代码">
                <el-input placeholder="请输入企业信用代码" v-model="orgcode"></el-input>
            </el-form-item>
            <el-form-item label="请选择导入年份">
                <el-date-picker v-model="exportyear"
                                type="year"
                                format="yyyy"
                                placeholder="选择年">
                </el-date-picker>
            </el-form-item>
        </div>

    </el-form>
    <el-form :inline="true" class="demo-form-inline">
        <el-form-item>
            <el-button type="primary" @@click="querydata">查询</el-button>
        </el-form-item>
        <el-form-item>
            <el-button type="success" @@click="exportdata">导出</el-button>
        </el-form-item>
        <el-form-item>
            <el-button type="success" @@click="downtemplate">下载模板</el-button>
        </el-form-item>
        <el-form-item>
            <el-upload class="upload-demo"
                       action="/api/pollutant/upload"
                       :before-upload="beforeUpload"
                       :data="model"
                       :show-file-list="false">
                <el-button size="small" type="primary">点击上传</el-button>
            </el-upload>
        </el-form-item>
    </el-form>

    <template>
        <el-table :data="data"
                  border
                  style="width: 100%"
                  v-loading="loading">
            <el-table-column fixed
                             prop="orgName"
                             label="企业名称"
                             width="150">
            </el-table-column>
            <el-table-column prop="town"
                             label="所属镇街"
                             width="120">
            </el-table-column>
            <el-table-column prop="orgCode"
                             label="统一社会信用代码"
                             width="150">
            </el-table-column>
            <el-table-column prop="registrationType"
                             label="登记注册类型"
                             width="120">
            </el-table-column>
            <el-table-column prop="address"
                             label="住所"
                             width="200">
            </el-table-column>
            <el-table-column prop="isInSystem"
                             label="是否纳入环统范围"
                             width="150">
            </el-table-column>

            <el-table-column prop="oxygen"
                             label="化学需氧量排放当量"
                             width="150">
            </el-table-column>
            <el-table-column prop="ammoniaNitrogen"
                             label="氨氮排放当量"
                             width="120">
            </el-table-column>
            <el-table-column prop="sulfurDioxide"
                             label="二氧化硫排放当量"
                             width="150">
            </el-table-column>
            <el-table-column prop="nitrogenOxide"
                             label="氮氧化物排放当量"
                             width="150">
            </el-table-column>
            <el-table-column prop="coal"
                             label="煤炭"
                             width="120">
            </el-table-column>
            <el-table-column prop="fuelOil"
                             label="燃料油"
                             width="120">
            </el-table-column>
            <el-table-column prop="hydrogen"
                             label="氢气"
                             width="120">
            </el-table-column>
            <el-table-column prop="firewood"
                             label="薪柴"
                             width="120">
            </el-table-column>
            <el-table-column prop="remark"
                             label="备注"
                             width="120">
            </el-table-column>
            <el-table-column fixed="right"
                             label="操作"
                             width="150">
                <template slot-scope="scope">
                    <el-button size="mini"
                               v-on:click="handleEdit(scope.$index, scope.row)">编辑</el-button>

                    <el-button size="mini"
                               type="danger"
                               v-on:click="handleDelete(scope.$index, scope.row)">删除</el-button>
                </template>
            </el-table-column>
        </el-table>
    </template>

    <el-pagination @@size-change="handleSizeChange"
                   @@current-change="handleCurrentChange"
                   :current-page="currentPage"
                   :page-sizes="[10, 20, 30, 40]"
                   :page-size="pageSize"
                   layout="total, sizes, prev, pager, next, jumper"
                   :total="total">
    </el-pagination>
</div>


<script>
    layui.use(['element', 'layer'], function () {
        var layer = layui.layer
        var form = layui.form;
        var $ = layui.$
    })
</script>

<script>
    new Vue({
        el: '#app',
        data() {
            return {
                loading: false,
                data:[],
                total:0,
                pageSize: 10,
                currentPage:1,
                value: '',
                exportyear: '',
                orgcode: '',
                orgname: '',
                model: { year: '' },
                tableData: [{
                    date: '2016-05-02',
                    name: '王小虎',
                    province: '上海',
                    city: '普陀区',
                    address: '上海市普陀区金沙江路 1518 弄',
                    zip: 200333
                }, {
                    date: '2016-05-04',
                    name: '王小虎',
                    province: '上海',
                    city: '普陀区',
                    address: '上海市普陀区金沙江路 1517 弄',
                    zip: 200333
                }, {
                    date: '2016-05-01',
                    name: '王小虎',
                    province: '上海',
                    city: '普陀区',
                    address: '上海市普陀区金沙江路 1519 弄',
                    zip: 200333
                }, {
                    date: '2016-05-03',
                    name: '王小虎',
                    province: '上海',
                    city: '普陀区',
                    address: '上海市普陀区金沙江路 1516 弄',
                    zip: 200333
                }]
            }
        },
        methods: {
            fetchlist() {
                let vm = this;

                axios({ url: `/api/pollutant/getlistpagination`, method: 'post', data: { orgname: vm.orgname, orgcode: vm.orgcode, limit: vm.pageSize, page: vm.currentPage } }).then(res => {
                    vm.data = res.data.content.data

                    vm.total = res.data.content.total
                    console.log(res.data.content.data)
                    vm.loading = false
                }).catch(err => { console.log(err); vm.loading = false })
                console.log(111)
            },
            querydata() {
                let vm = this
                vm.fetchlist()
            },
            beforeUpload() {
                let vm = this
                try {

                    vm.model.year = vm.exportyear.getFullYear()
                    if (vm.model.year === '') {
                        vm.$message.error('请先选择年份!');
                        return false
                    }
                } catch (e) {
                    vm.$message.error('请先选择年份!');
                    return false
                }
            },
            exportdata() {
                window.location.href = '/api/pollutant/export'
            },
            downtemplate() {
                window.location.href = `/api/pollutant/downtemplate`
            },
            handleEdit(index,row) { },
            handleDelete(index, row) {
                let vm = this

                vm.$confirm('此操作将永久删除该数据, 是否继续?', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    let url = `/api/pollutant/delete/${row.recordId}`
                    let method = 'get'
                    axios({ url: url, method: method })
                        .then(res => {
                            if (res.data.isSuccess === true) {
                                vm.$message.success('操作成功！');
                                vm.fetchlist();
                            }
                            console.log(res)
                        })
                        .catch(error => {
                            vm.$message.error('操作失败，意外的原因！');
                            console.log(error)
                        })
                }).catch(() => {
                    vm.$message({
                        type: 'info',
                        message: '已取消删除'
                    });
                });
            },
            handleSizeChange(val) {
                let vm = this
                vm.pageSize = val
                vm.fetchlist()
                console.log(`每页 ${val} 条`);
            },
            handleCurrentChange(val) {
                let vm = this
                vm.currentPage = val
                vm.fetchlist()
                console.log(`当前页: ${val}`);
            }
        },
        mounted() {
            let vm = this
            vm.loading = true
            vm.fetchlist()
        }
    })
</script>